# 賞与計算仕様（spec-bonus）

## 1. 目的
賞与（ボーナス）支給時に必要な社会保険料計算を、外部サイトに依存せず本プラグイン内で再現可能にする。

## 2. 対象範囲
- 賞与に対する社会保険料計算
  - 健康保険
  - 介護保険（対象者のみ）
  - 厚生年金
  - 雇用保険（運用方針に応じてON/OFF）
- 本仕様は「給与明細（月次）」とは別に「賞与計算」向けルールを定義する。

## 3. 前提
- 法令・料率は改定されるため、年度単位での更新運用を前提とする。
- 国税庁・協会けんぽ・厚労省公開情報を一次ソースとし、必要に応じて手動更新する。
- すべての計算は円単位で行う。

## 4. 入力項目
- `bonus_amount` : 賞与支給額（課税対象）
- `target_term` : 適用時期（料率判定用）
- `age` : 年齢（介護保険判定用）
- `prefecture` : 都道府県（健康保険率判定用）
- `insured_type` : 被保険者区分
- `employment_insurance_exempt` : 雇用保険自動計算除外フラグ
- `manual_override` : 手入力上書き値（任意）

## 5. 出力項目
- `bonus_kenkou_hoken`
- `bonus_kaigo_hoken`
- `bonus_nenkin`
- `bonus_koyou_hoken`
- `bonus_shakai_hoken_total`

## 6. 計算ルール
1. 健康保険料
- `bonus_amount × 健康保険料率` で計算する。
- 介護保険対象者は `介護保険料率` を加算する。

2. 厚生年金保険料
- `bonus_amount × 厚生年金保険料率` で計算する。

3. 雇用保険料
- `employment_insurance_exempt = true` の場合は `0`。
- それ以外は `bonus_amount × 雇用保険料率`。

4. 社会保険料合計
- `bonus_kenkou_hoken + bonus_kaigo_hoken + bonus_nenkin + bonus_koyou_hoken`

## 7. 丸め
- 各保険料ごとに円未満を四捨五入する。
- 合計値は丸め後の各値を加算して算出する。

## 8. 上限・例外
- 賞与の標準賞与額上限は法令に従う。
- 上限超過時は上限値を計算対象とする。
- 負数・非数値入力は `0` として扱うか、エラーとして返すかを実装時に統一する。

## 9. データソース方針
1. API取得可能な情報
- 法令本文: e-Gov 法令 API

2. API未整備で手動取り込みが必要な情報
- 協会けんぽ都道府県別料率
- 雇用保険料率
- 国税庁の税額表

3. 運用
- 年度改定時に `target_term` と対応する料率マスタを更新する。
- 改定日・適用開始日・情報源URLを変更履歴に残す。

## 10. 未確定事項（要決定）
- 雇用保険を賞与計算に常時含めるか
- 介護保険判定の年齢基準日（支給日基準/資格取得基準）
- 上限判定を簡易化するか、厳密な法令運用と同等にするか
- 手入力上書き値を許可する範囲

## 11. 変更履歴
- 2026-02-26: 初版作成
